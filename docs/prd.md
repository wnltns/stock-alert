# Project Overview

**ê°„ë‹¨í•œ ì„¤ëª…**
StockAlertëŠ” ì‚¬ìš©ìê°€ ê´€ì‹¬ ìˆëŠ” ì£¼ì‹ì„ ë“±ë¡í•˜ê³ , ì§€ì •í•œ ë“±ë½ë¥  ì¡°ê±´ì„ ë§Œì¡±í–ˆì„ ë•Œ ìë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë³´ë‚´ì£¼ëŠ” ì•±ì…ë‹ˆë‹¤.
ì‚¬ìš©ìëŠ” ë§¤ì¼ ì£¼ê°€ë¥¼ ì¼ì¼ì´ í™•ì¸í•˜ì§€ ì•Šì•„ë„, ì„¤ì •í•œ ì¡°ê±´ì— ë”°ë¼ ìë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë°›ì•„ íš¨ìœ¨ì ìœ¼ë¡œ ì£¼ì‹ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•µì‹¬ ê¸°ëŠ¥ ìš”ì•½**
- ì‚¬ìš©ìê°€ ì£¼ì‹ì„ êµ¬ë…í•˜ê³  ì•Œë¦¼ ì¡°ê±´ì„ ì„¤ì •í•  ìˆ˜ ìˆìŒ
- ì‹œìŠ¤í…œì´ ë§¤ì¼ ì£¼ê°€ë¥¼ ìë™ìœ¼ë¡œ ì¡°íšŒí•˜ì—¬ ì¡°ê±´ì„ ì²´í¬
- ì¡°ê±´ ì¶©ì¡± ì‹œ ì•± í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡

---

# Core Functionalities

### 1. ì£¼ì‹ êµ¬ë…í•˜ê¸°
- ì‚¬ìš©ìëŠ” ì•± ë‚´ì—ì„œ ì›í•˜ëŠ” ì£¼ì‹ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- êµ¬ë…ëœ ì£¼ì‹ì€ ë‚´ ë¦¬ìŠ¤íŠ¸ì— í‘œì‹œë©ë‹ˆë‹¤. (ë©”ì¸í™”ë©´)

**êµ¬ì²´ì ì¸ ì„¤ëª…**
- í–‰ë™: ì‚¬ìš©ìê°€ ë“±ë¡ì°½ì—ì„œ "ì‚¼ì„±ì „ì" ì½”ë“œ ìˆ˜ë™ì…ë ¥ â†’ ì£¼ì‹ëª… â†’ "ì¶”ê°€" ë²„íŠ¼ í´ë¦­
- ë°˜ì‘: ì‹œìŠ¤í…œì€ í•´ë‹¹ ì¢…ëª©ì„ ì‚¬ìš©ì ê´€ì‹¬ëª©ë¡ì— ì €ì¥í•˜ê³ , ì¶”ì  ì‹œì‘

---

### 2. ì•Œë¦¼ ì¡°ê±´ ì„¤ì •í•˜ê¸°
- ì‚¬ìš©ìëŠ” ì£¼ê°€ ë³€ë™ ì¡°ê±´(ìƒìŠ¹/í•˜ë½ %, ê¸°ê°„ ë“±)ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì˜ˆì‹œ: "í•˜ë£¨ë§Œì— 4% ì´ìƒ í•˜ë½", "3ì¼ ë‚´ 8% ìƒìŠ¹"

**êµ¬ì²´ì ì¸ ì„¤ëª…**
- í–‰ë™: ì‚¬ìš©ìê°€ "ì¡°ê±´ ì¶”ê°€" ë²„íŠ¼ í´ë¦­ â†’ ê¸°ì¤€(ê¸°ê°„, ë“±ë½ë¥ , ìƒìŠ¹/í•˜ë½ ì—¬ë¶€) ì…ë ¥ â†’ ì €ì¥
- ë°˜ì‘: ì‹œìŠ¤í…œì€ ì¡°ê±´ì„ DBì— ì €ì¥í•˜ê³ , ë§¤ì¼ ì¡°ê±´ì— ë”°ë¼ ìë™ ê³„ì‚°

---

### 3. ìë™ ì¡°íšŒ ë° ì¡°ê±´ ì²´í¬
- ì‹œìŠ¤í…œì€ í•˜ë£¨ì— í•œ ë²ˆ(ì˜ˆ: ì¥ ë§ˆê° í›„) ëª¨ë“  êµ¬ë… ì¢…ëª©ì˜ ì£¼ê°€ë¥¼ ìë™ìœ¼ë¡œ ì¡°íšŒ
- ê° ì£¼ì‹ì— ëŒ€í•´ ì„¤ì •ëœ ì¡°ê±´ì„ í™•ì¸í•˜ì—¬ ì¶©ì¡± ì—¬ë¶€ë¥¼ íŒë³„

**êµ¬ì²´ì ì¸ ì„¤ëª…**
- í–‰ë™: ì„œë²„ì—ì„œ ë§¤ì¼ ì˜¤í›„ 6ì‹œì— ì£¼ê°€ API í˜¸ì¶œ
- ë°˜ì‘: ì¡°ê±´ ì¶©ì¡± ì‹œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ê³  í‘¸ì‹œ ì•Œë¦¼ ëŒ€ê¸°ì—´ì— ë“±ë¡

---

### 4. ìë™ ì¡°íšŒ ì„¤ì •í•˜ê¸°
- ì‹œìŠ¤í…œì´ ëª‡ ì‹œì— êµ¬ë… ì¢…ëª©ì˜ ì£¼ê°€ë¥¼ ì¡°íšŒí• ì§€ ì„¤ì •
- í•œêµ­, ë¯¸êµ­ ì¥ ì˜¤í”ˆí•˜ëŠ” ì‹œê¸°ê°€ ë‹¤ë¥´ë¯€ë¡œ ê°ê° ë‹¤ë¥´ê²Œ ì„¤ì •

---

### 5. ì•± í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡
- ì¡°ê±´ ì¶©ì¡± ì‹œ ì•±ìœ¼ë¡œ ì¦‰ì‹œ í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡
- ì•Œë¦¼ ë©”ì‹œì§€ ì˜ˆì‹œ:
  - "ì‚¼ì„±ì „ì: í•˜ë£¨ -4.2% í•˜ë½"
  - "ë„¤ì´ë²„: ìµœê·¼ 3ì¼ê°„ +9% ìƒìŠ¹"

---

### 6. ì¶”ì ì¼ ì´ˆê¸°í™”
- ì‚¬ìš©ìëŠ” íŠ¹ì • ì¢…ëª©ì˜ ì¡°ê±´ ì¶”ì ì„ ì´ˆê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì˜ˆ: "ì‚¼ì„±ì „ì 3ì¼ ìƒìŠ¹ ì¡°ê±´" â†’ ì´ˆê¸°í™”í•˜ë©´ 1ì¼ë¶€í„° ë‹¤ì‹œ ì¹´ìš´íŠ¸

**êµ¬ì²´ì ì¸ ì„¤ëª…**
- í–‰ë™: ì‚¬ìš©ìê°€ "ì´ˆê¸°í™”" ë²„íŠ¼ í´ë¦­
- ë°˜ì‘: ì‹œìŠ¤í…œì€ í•´ë‹¹ ì¢…ëª©ì˜ ì¡°ê±´ ì¶”ì  ê¸°ë¡ì„ ì‚­ì œí•˜ê³  ìƒˆë¡œ ì‹œì‘

---

# Documentation

# í•„ìš”í•œ íŒ¨í‚¤ì§€ì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬

- **Next.js 15**: ì›¹ì•± ë° PWA êµ¬í˜„ (App Router, API Routes)  
- **React 19**: UI ì»´í¬ë„ŒíŠ¸ êµ¬ì„±  
- **Supabase**: ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (PostgreSQL, Auth, Scheduled Functions, Edge Functions)
  - `@supabase/supabase-js`: Supabase í´ë¼ì´ì–¸íŠ¸
  - `@supabase/auth-helpers-nextjs`: Next.js ì¸ì¦ í—¬í¼
- **Firebase Cloud Messaging (FCM)**: í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡ ë° ìˆ˜ì‹  (Service Workerì™€ ì—°ê³„)  
- **shadcn/ui**: UI ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **Tailwind CSS**: ìŠ¤íƒ€ì¼ë§ í”„ë ˆì„ì›Œí¬
- **Lucide React**: ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **Zod**: ë°ì´í„° ê²€ì¦ ìŠ¤í‚¤ë§ˆ
- **TypeScript**: ì•ˆì •ì ì¸ íƒ€ì… ê´€ë¦¬  
- **ESLint / Prettier**: ì½”ë“œ í’ˆì§ˆ ê´€ë¦¬  

> âš  ì„œë²„ë¦¬ìŠ¤ í™˜ê²½ì—ì„œëŠ” Node-cronì´ë‚˜ Redis ì—†ì´ **Supabase Scheduled Functions**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ê¸°ì  ì£¼ê°€ ì¡°íšŒ ë° ì•Œë¦¼ ìŠ¤ì¼€ì¤„ë§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

# ì½”ë“œ ì˜ˆì‹œ (ì£¼ê°€ ì¡°íšŒ ë° ì¡°ê±´ ì²´í¬ â€” Supabase Scheduled Function)

```typescript
// /supabase/functions/check-stocks/index.ts
// ë§¤ì¼ ì„¤ì •ëœ ì‹œê°„ì— ì‹¤í–‰ë˜ëŠ” Scheduled Function
import { serve } from "https://deno.land/std/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const supabaseUrl = Deno.env.get("SUPABASE_URL")!;
const supabaseKey = Deno.env.get("SUPABASE_SERVICE_ROLE_KEY")!;
const supabase = createClient(supabaseUrl, supabaseKey);

async function checkConditions() {
  console.log("ğŸ”„ ì •ê¸°ì  ì£¼ê°€ ì¡°íšŒ ë° ì¡°ê±´ ì²´í¬ ì‹œì‘...");
  
  // í™œì„±í™”ëœ ì£¼ì‹ êµ¬ë… ì¡°íšŒ
  const { data: subscriptions, error: subError } = await supabase
    .from("stock_subscriptions")
    .select(`
      id,
      user_id,
      stock_code,
      stock_name,
      alert_conditions!inner(
        id,
        condition_type,
        threshold,
        period_days,
        is_active
      )
    `)
    .eq("is_active", true);

  if (subError) {
    console.error("êµ¬ë… ì¡°íšŒ ì˜¤ë¥˜:", subError);
    return;
  }

  for (const subscription of subscriptions ?? []) {
    try {
      // ì™¸ë¶€ ì£¼ê°€ APIì—ì„œ í˜„ì¬ ê°€ê²© ì¡°íšŒ
      const stockResponse = await fetch(`https://api.example.com/stocks/${subscription.stock_code}`);
      const stockData = await stockResponse.json();
      const currentPrice = stockData.price;

      // ê° ì¡°ê±´ ê²€ì‚¬
      for (const condition of subscription.alert_conditions) {
        if (!condition.is_active) continue;

        const isConditionMet = validateCondition(condition, currentPrice);
        
        if (isConditionMet) {
          // ì¡°ê±´ ì¶©ì¡± ì‹œ ì•Œë¦¼ ìƒì„±
          await createNotification(subscription, condition, currentPrice);
          
          // ì¡°ê±´ ì¶©ì¡± ì‹œê°„ ì—…ë°ì´íŠ¸
          await supabase
            .from("alert_conditions")
            .update({ 
              condition_met_at: new Date().toISOString(),
              last_checked_at: new Date().toISOString()
            })
            .eq("id", condition.id);
        } else {
          // ì¡°ê±´ ì²´í¬ ì‹œê°„ë§Œ ì—…ë°ì´íŠ¸
          await supabase
            .from("alert_conditions")
            .update({ last_checked_at: new Date().toISOString() })
            .eq("id", condition.id);
        }
      }
    } catch (error) {
      console.error(`ì£¼ì‹ ${subscription.stock_code} ì²˜ë¦¬ ì˜¤ë¥˜:`, error);
    }
  }
}

function validateCondition(condition: any, currentPrice: number): boolean {
  const { condition_type, threshold } = condition;
  
  switch (condition_type) {
    case "drop":
      // í•˜ë½ ì¡°ê±´ ë¡œì§ (ì‹¤ì œë¡œëŠ” ê¸°ê°„ë³„ ê°€ê²© íˆìŠ¤í† ë¦¬ í•„ìš”)
      return true; // ì„ì‹œë¡œ í•­ìƒ true ë°˜í™˜
    case "rise":
      // ìƒìŠ¹ ì¡°ê±´ ë¡œì§ (ì‹¤ì œë¡œëŠ” ê¸°ê°„ë³„ ê°€ê²© íˆìŠ¤í† ë¦¬ í•„ìš”)
      return true; // ì„ì‹œë¡œ í•­ìƒ true ë°˜í™˜
    default:
      return false;
  }
}

async function createNotification(subscription: any, condition: any, currentPrice: number) {
  const { data: fcmTokens } = await supabase
    .from("fcm_tokens")
    .select("token")
    .eq("user_id", subscription.user_id)
    .eq("is_active", true);

  if (!fcmTokens || fcmTokens.length === 0) return;

  const notification = {
    user_id: subscription.user_id,
    subscription_id: subscription.id,
    condition_id: condition.id,
    notification_type: "push",
    title: `${subscription.stock_name} ì•Œë¦¼`,
    message: `${condition.condition_type} ì¡°ê±´ ì¶©ì¡±`,
    sent_at: new Date().toISOString(),
    delivery_status: "pending"
  };

  // ì•Œë¦¼ ê¸°ë¡ ì €ì¥
  const { data: notificationRecord } = await supabase
    .from("notifications")
    .insert(notification)
    .select()
    .single();

  // FCM í‘¸ì‹œ ì•Œë¦¼ ë°œì†¡
  for (const tokenData of fcmTokens) {
    try {
      await fetch("https://fcm.googleapis.com/fcm/send", {
        method: "POST",
        headers: {
          "Authorization": `key=${Deno.env.get("FCM_SERVER_KEY")}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          to: tokenData.token,
          notification: {
            title: notification.title,
            body: notification.message
          }
        })
      });

      // ì „ë‹¬ ìƒíƒœ ì—…ë°ì´íŠ¸
      await supabase
        .from("notifications")
        .update({ 
          delivery_status: "sent",
          delivery_confirmed_at: new Date().toISOString()
        })
        .eq("id", notificationRecord.id);
    } catch (error) {
      console.error("FCM ì „ì†¡ ì˜¤ë¥˜:", error);
      await supabase
        .from("notifications")
        .update({ 
          delivery_status: "failed",
          error_message: error.message
        })
        .eq("id", notificationRecord.id);
    }
  }
}

serve(async () => {
  await checkConditions();
  return new Response("Stock check completed!", { status: 200 });
});
```

* **ì‹¤í–‰ ì£¼ê¸°**: Supabase Scheduled Functions ì„¤ì • â†’ ë§¤ì¼ 18ì‹œ ì‹¤í–‰
* **ë°ì´í„° íë¦„**:

  1. `stock_subscriptions` â†’ ì‚¬ìš©ìê°€ êµ¬ë…í•œ ì¢…ëª© ì¡°íšŒ
  2. ì™¸ë¶€ ì£¼ê°€ API â†’ ìµœì‹  ì£¼ê°€ ê°€ì ¸ì˜¤ê¸°
  3. `alert_conditions` â†’ ì¡°ê±´ ê²€ì‚¬
  4. `notifications` â†’ ì•Œë¦¼ ê¸°ë¡ ì €ì¥
  5. `fcm_tokens` â†’ ì‚¬ìš©ì ë””ë°”ì´ìŠ¤ í† í° ì¡°íšŒ í›„ ì•Œë¦¼ ë°œì†¡

---

# Current File Structure (Supabase ì—°ë™)

```
/stock-alert-app
 â”œâ”€â”€ /public
 â”‚    â”œâ”€â”€ firebase-messaging-sw.js   # FCM Service Worker
 â”‚    â”œâ”€â”€ manifest.json              # PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸
 â”‚    â””â”€â”€ icons/                     # PWA ì•„ì´ì½˜ ë¦¬ì†ŒìŠ¤
 â”œâ”€â”€ /src
 â”‚    â”œâ”€â”€ /app                       # Next.js App Router
 â”‚    â”‚    â”œâ”€â”€ /api                  # API Routes
 â”‚    â”‚    â”‚    â”œâ”€â”€ /auth             # ì¸ì¦ ê´€ë ¨ API
 â”‚    â”‚    â”‚    â”œâ”€â”€ /subscriptions    # êµ¬ë… ê´€ë ¨ API
 â”‚    â”‚    â”‚    â””â”€â”€ /conditions       # ì¡°ê±´ ê´€ë ¨ API
 â”‚    â”‚    â”œâ”€â”€ /auth                 # ì¸ì¦ í˜ì´ì§€
 â”‚    â”‚    â”‚    â”œâ”€â”€ login/            # ë¡œê·¸ì¸ í˜ì´ì§€
 â”‚    â”‚    â”‚    â””â”€â”€ signup/           # íšŒì›ê°€ì… í˜ì´ì§€
 â”‚    â”‚    â”œâ”€â”€ /dashboard            # ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
 â”‚    â”‚    â”œâ”€â”€ /settings             # ì„¤ì • í˜ì´ì§€
 â”‚    â”‚    â”œâ”€â”€ globals.css            # ì „ì—­ ìŠ¤íƒ€ì¼
 â”‚    â”‚    â”œâ”€â”€ layout.tsx             # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
 â”‚    â”‚    â””â”€â”€ page.tsx               # ë©”ì¸ í˜ì´ì§€
 â”‚    â”œâ”€â”€ /components                # UI ì»´í¬ë„ŒíŠ¸
 â”‚    â”‚    â”œâ”€â”€ /ui                   # shadcn/ui ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸
 â”‚    â”‚    â”œâ”€â”€ /auth                 # ì¸ì¦ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
 â”‚    â”‚    â”œâ”€â”€ /stock                # ì£¼ì‹ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
 â”‚    â”‚    â””â”€â”€ /condition            # ì¡°ê±´ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
 â”‚    â”œâ”€â”€ /lib                       # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° ì„¤ì •
 â”‚    â”‚    â”œâ”€â”€ /supabase             # Supabase í´ë¼ì´ì–¸íŠ¸
 â”‚    â”‚    â”‚    â”œâ”€â”€ client.ts        # í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í´ë¼ì´ì–¸íŠ¸
 â”‚    â”‚    â”‚    â”œâ”€â”€ server.ts         # ì„œë²„ ì‚¬ì´ë“œ í´ë¼ì´ì–¸íŠ¸
 â”‚    â”‚    â”‚    â””â”€â”€ middleware.ts     # ë¯¸ë“¤ì›¨ì–´ í´ë¼ì´ì–¸íŠ¸
 â”‚    â”‚    â”œâ”€â”€ /validations          # Zod ê²€ì¦ ìŠ¤í‚¤ë§ˆ
 â”‚    â”‚    â”œâ”€â”€ /utils.ts             # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
 â”‚    â”‚    â””â”€â”€ /auth.ts              # ì¸ì¦ í—¬í¼ í•¨ìˆ˜
 â”‚    â”œâ”€â”€ /types                     # TypeScript íƒ€ì… ì •ì˜
 â”‚    â”‚    â”œâ”€â”€ /database.ts          # ë°ì´í„°ë² ì´ìŠ¤ íƒ€ì…
 â”‚    â”‚    â”œâ”€â”€ /auth.ts              # ì¸ì¦ íƒ€ì…
 â”‚    â”‚    â””â”€â”€ /api.ts               # API íƒ€ì…
 â”‚    â”œâ”€â”€ /hooks                     # ì»¤ìŠ¤í…€ React í›…
 â”‚    â”‚    â”œâ”€â”€ /supabase             # Supabase ê´€ë ¨ í›…
 â”‚    â”‚    â”‚    â”œâ”€â”€ use-user.ts      # ì‚¬ìš©ì ìƒíƒœ í›…
 â”‚    â”‚    â”‚    â”œâ”€â”€ use-subscriptions.ts # êµ¬ë… ê´€ë¦¬ í›…
 â”‚    â”‚    â”‚    â””â”€â”€ use-conditions.ts    # ì¡°ê±´ ê´€ë¦¬ í›…
 â”‚    â”‚    â””â”€â”€ /auth.ts              # ì¸ì¦ ê´€ë ¨ í›…
 â”‚    â””â”€â”€ /constants                 # ìƒìˆ˜ ì •ì˜
 â”œâ”€â”€ /supabase
 â”‚    â”œâ”€â”€ /functions                 # Supabase Edge Functions
 â”‚    â”‚    â”œâ”€â”€ /check-stocks/        # ì£¼ê°€ ì²´í¬ í•¨ìˆ˜
 â”‚    â”‚    â””â”€â”€ /send-notifications/ # ì•Œë¦¼ ë°œì†¡ í•¨ìˆ˜
 â”‚    â”œâ”€â”€ /migrations               # ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
 â”‚    â”œâ”€â”€ /seed.sql                 # ì´ˆê¸° ë°ì´í„°
 â”‚    â””â”€â”€ config.toml               # Supabase ì„¤ì •
 â”œâ”€â”€ .env.local                     # í™˜ê²½ ë³€ìˆ˜
 â”œâ”€â”€ package.json
 â”œâ”€â”€ tsconfig.json
 â”œâ”€â”€ tailwind.config.js
 â””â”€â”€ README.md
```

* **/src/lib/supabase/client.ts** â†’ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ Supabase í´ë¼ì´ì–¸íŠ¸
* **/src/lib/supabase/server.ts** â†’ ì„œë²„ ì‚¬ì´ë“œ Supabase í´ë¼ì´ì–¸íŠ¸  
* **/supabase/functions/check-stocks** â†’ ë§¤ì¼ ì •ê¸°ì  ì£¼ê°€ ì¡°íšŒ ë° ì¡°ê±´ ê²€ì‚¬ í•¨ìˆ˜
* **/src/hooks/supabase/** â†’ Supabase ë°ì´í„° ê´€ë¦¬ë¥¼ ìœ„í•œ ì»¤ìŠ¤í…€ í›…
* **/src/app/api/** â†’ Next.js API Routes (Supabase ì—°ë™)

```
