---
title: "Supabase 연동 규칙"
description: "StockAlert 프로젝트의 Supabase 데이터베이스 연동 및 인증 규칙"
---

# Supabase 연동 규칙

## Supabase 클라이언트 설정
- **클라이언트**: `@supabase/supabase-js` 사용
- **타입 생성**: `supabase gen types typescript` 명령어로 타입 자동 생성
- **환경 변수**: `.env.local`에 Supabase URL과 Anon Key 저장
- **클라이언트 초기화**: `src/lib/supabase/client.ts`에서 클라이언트 생성

## 인증 시스템
- **Supabase Auth**: 이메일/비밀번호 기반 인증
- **세션 관리**: `useUser()` 훅으로 사용자 상태 관리
- **보호된 라우트**: 미들웨어를 통한 인증 검증
- **소셜 로그인**: Google, GitHub 등 소셜 로그인 지원 (선택사항)

## 데이터베이스 보안
- **Row Level Security (RLS)**: 모든 테이블에 RLS 정책 적용
- **사용자별 데이터 격리**: 사용자는 자신의 데이터만 접근 가능
- **API 보안**: 서버 사이드에서 인증 토큰 검증
- **데이터 검증**: Zod 스키마를 통한 입력 데이터 검증

## 실시간 기능
- **배치 처리**: 정기적 주가 조회 및 조건 체크 (매일 설정된 시간)
- **Scheduled Functions**: Supabase Scheduled Functions를 통한 자동화된 작업
- **조건 체크**: 주가 변동에 따른 알림 조건 자동 검사
- **알림 발송**: 조건 충족 시 FCM을 통한 푸시 알림 발송

## API 설계 패턴
- **RESTful API**: Next.js API Routes 활용
- **타입 안전성**: Supabase 생성 타입 활용
- **에러 핸들링**: 일관된 에러 응답 형식
- **페이지네이션**: 대용량 데이터 처리를 위한 페이지네이션

## 데이터베이스 최적화
- **인덱스**: 자주 조회되는 컬럼에 인덱스 설정
- **쿼리 최적화**: 필요한 데이터만 조회하는 효율적인 쿼리
- **캐싱**: 자주 조회되는 데이터의 클라이언트 사이드 캐싱
- **배치 처리**: 대량 데이터 처리를 위한 배치 작업

## 에러 처리 전략
- **Supabase 에러**: 데이터베이스 에러를 사용자 친화적 메시지로 변환
- **네트워크 에러**: 연결 실패 시 재시도 로직
- **인증 에러**: 토큰 만료 시 자동 로그아웃
- **권한 에러**: 접근 권한 없음 시 적절한 페이지로 리다이렉트

## 개발 환경 설정
- **로컬 개발**: Supabase CLI를 통한 로컬 개발 환경
- **마이그레이션**: 데이터베이스 스키마 변경 관리
- **시드 데이터**: 개발용 초기 데이터 설정
- **테스트**: 단위 테스트 및 통합 테스트 환경